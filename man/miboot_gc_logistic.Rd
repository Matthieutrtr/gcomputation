\name{miboot_gc_logistic}
\alias{miboot_gc_logistic}
\title{
G-computation for Marginal Logistic Effects with Multiple Imputation
}
\description{
This function performs G-computation (GC) for marginal logistic effects on datasets with missing values by first applying multiple imputation using the \code{\link[mice]{mice}} package and then running \code{\link{gc_logistic}} on each imputed dataset. The bootstrap samples from all imputed datasets are combined to provide a single set of estimates.
}
\usage{
miboot_gc_logistic(formula, data, group, ..., m = 5,
                    effect = "ATE", gc.method, param.tune = NULL, cv = 10,
                    boot.type = "bcv", boot.number = 500,
                    boot.tune = FALSE, progress = TRUE, seed = NULL)
}
\arguments{
  \item{formula}{
A logistic regression formula related to the Q-model with the variable \code{group} among the predictors. For details, see \code{\link{gc_survival}}.
}
  \item{data}{
A data frame containing the variables for the outcome, the exposure (\code{group}), and the predictors. This dataset may contain missing values, which will be imputed by multiple imputation.
}
  \item{group}{
The name of the variable related to the exposure/treatment. This variable should have two modalities (0 for untreated/unexposed and 1 for treated/exposed).
}
  \item{...}{
Additional arguments to be passed directly to the \code{\link[mice]{mice}} function for customizing the multiple imputation process (e.g., \code{method}, \code{maxit}, \code{diagnostics}).
}
  \item{m}{
The number of imputed datasets to create using \code{mice}. The default value is 5.
}
  \item{effect}{
The type of marginal effect to be estimated ("ATE", "ATT", or "ATU"). The default is "ATE".
}
  \item{gc.method}{
The method used to create the Q-model for G-computation (e.g., "all", "lasso", "ridge", "elasticnet", "aic", "bic"). This argument is named \code{gc.method} here to avoid conflict with the \code{method} argument in the \code{\link[mice]{mice}} function. For details, see \code{method} in \code{\link{gc_logistic}}.
}
  \item{param.tune}{
An optional argument to specify the tuning parameters for the Q-model. If \code{NULL} (the default), tuning parameters are estimated by cross-validation for each algorithm..
}
  \item{cv}{
The number of splits for cross-validation used during Q-model fitting. The default value is 10..
}
  \item{boot.type}{
The type of bootstrap to use ("bcv" or "boot"). The default value is "bcv".
}
  \item{boot.number}{
The number of bootstrap resamples to perform *for each imputed dataset*. The total number of bootstrap samples in the final combined results will be \code{m} * \code{boot.number}. The default value is 500.
}
  \item{boot.tune}{
A logical value to determine whether the tuning parameter should be estimated inside of each bootstrap iteration for \code{gc_logistic}.
}
  \item{progress}{
A logical value to print a progress bar for the imputation process and the G-computation loop in the R console. The default is \code{TRUE}.
}
  \item{seed}{
A random seed to ensure reproducibility of the imputation process and the bootstrapping steps within \code{gc_logistic}. If \code{NULL} (the default), a seed is randomly assigned.
}
}
\details{
The \code{miboot_gc_logistic} function integrates multiple imputation for handling missing data with G-computation for causal inference. The steps it does:
\enumerate{
    \item Multiple Imputation: The input \code{data} is first subjected to multiple imputation using the \code{\link[mice]{mice}} function. This creates \code{m} complete datasets. Additional arguments for customizing the \code{mice} function (e.g., imputation methods for different variable types) can be passed via the \code{...} argument.
    \item G-computation and combination: For each of the \code{m} imputed datasets, the \code{\link{gc_logistic}} function is called to estimate the marginal logistic effects. All parameters specific to \code{gc_logistic} are passed directly. The raw bootstrap estimates generated by each \code{gc_logistic} call are concatenated. This results in a final set of bootstrap samples that accounts for both imputation uncertainty and sampling variability, following the MI BOOT method (see references).
}

The final returned object is structured similarly to a standard \code{gclogi} object, ensuring compatibility with its S3 methods (\code{print.gclogi}, \code{summary.gclogi}). However, several fields are modified by the multiple imputation process:
\itemize{
    \item \code{calibration}: This field contains a list of the \code{calibration} objects (each with a fitted Q-model and predictions) from each of the \code{m} \code{gc_logistic} runs.
    \item \code{tuning.parameters}: This field contains a list of vectors (\code{lambda} and \code{alpha}) which store all the optimal tuning parameters identified across the \code{m} \code{gc_logistic} runs.
    \item \code{data}: This field contains a list of the \code{m} complete imputed datasets.
    \item \code{initial.data}: This new field stores the original \code{data} frame as supplied to \code{miboot_gc_logistic}, before any imputation with the missing data.
    \item \code{boot.number}: This field reflects the total number of combined bootstrap samples (\code{m} * \code{boot.number} argument).
    \item \code{m}: This new field indicates the number of imputed datasets used from the initial call.
}
}
\value{
The function returns an object of class \code{"gclogi"}, which is a list containing the following elements, updated to reflect the multiple imputation and aggregation:
\item{calibration}{A list of \code{m} lists, where each inner list contains the final fitted Q-model (\code{fit}) and the outcome predictions (\code{predict}) from one of the imputed datasets.}
\item{tuning.parameters}{A list containing vectors of optimal \code{lambda} and \code{alpha} values (if applicable), where each vector element corresponds to the optimal parameter from one of the \code{m} imputed datasets.}
\item{data}{A list of \code{m} data frames, where each element is one of the complete imputed datasets used in the G-computation.}
\item{formula}{The original formula provided to the function.}
\item{method}{The method used for the Q-model (e.g., "lasso", "ridge", "aic").}
\item{cv}{The number of splits used for cross-validation for the Q-model.}
\item{missing}{The number of observations that were removed due to missing values during the processing of the *first* imputed dataset (which defines the structural elements of the resulting \code{gclogi} object).}
\item{boot.number}{The total number of bootstrap resamples performed across all imputed datasets (\code{m} * \code{boot.number} argument).}
\item{boot.type}{The type of bootstrap resamples performed.}
\item{outcome}{A character string specifying the name of the outcome variable.}
\item{group}{A character string specifying the name of the grouping (exposure/treatment) variable.}
\item{n}{The sample size of the imputed dataset used in calculations.}
\item{nevent}{The total number of events (outcomes coded as 1) in the imputed dataset used in calculations.}
\item{p0}{A numeric vector containing the raw bootstrap samples of the estimated proportion of events in the control group, combined from all \code{m} imputed datasets.}
\item{p1}{A numeric vector containing the raw bootstrap samples of the estimated proportion of events in the experimental group, combined from all \code{m} imputed datasets.}
\item{delta}{A numeric vector containing the raw bootstrap samples of the estimated difference in proportions of events (\code{p1} - \code{p0}), combined from all \code{m} imputed datasets.}
\item{ratio}{A numeric vector containing the raw bootstrap samples of the estimated ratio of proportions of events (\code{p1} / \code{p0}), combined from all \code{m} imputed datasets.}
\item{OR}{A numeric vector containing the raw bootstrap samples of the estimated odds ratio, combined from all \code{m} imputed datasets.}
\item{p0.unadj}{A numeric vector containing the raw bootstrap samples of the unadjusted proportion of events in the control group, combined from all \code{m} imputed datasets.}
\item{p1.unadj}{A numeric vector containing the raw bootstrap samples of the unadjusted proportion of events in the experimental group, combined from all \code{m} imputed datasets.}
\item{delta.unadj}{A numeric vector containing the raw bootstrap samples of the unadjusted difference in proportions of events (\code{p1.unadj} - \code{p0.unadj}), combined from all \code{m} imputed datasets.}
\item{ratio.unadj}{A numeric vector containing the raw bootstrap samples of the unadjusted ratio of proportions of events (\code{p1.unadj} / \code{p0.unadj}), combined from all \code{m} imputed datasets.}
\item{OR.unadj}{A numeric vector containing the raw bootstrap samples of the unadjusted odds ratio, combined from all \code{m} imputed datasets.}
\item{call}{The function call that generated the \code{miboot_gc_logistic} object.}
\item{m}{The number of imputed datasets used.}
\item{initial.data}{The original data frame supplied to the \code{miboot_gc_logistic} function before imputation.}
\item{seed}{The random seed used for the imputation process and for generating seeds for each \code{gc_logistic} call.}
}
\references{
Joe de Keizer et al. G-computation for increasing performances of clinical trials with individual randomization and binary response. ArXiv 2024-11. <doi: 10.48550/arXiv.2411.10089>.

Schomaker M, Heumann C. Bootstrap Inference When Using Multiple Imputation. Statistics in medicine. 2018;37(14):2252-2266. doi: 10.1002/sim.7654.

Van Buuren, S., & Groothuis-Oudshoorn, K. (2011). mice: Multivariate Imputation by Chained Equations in R. Journal of Statistical Software, 45(3), 1-67.
}
\examples{
data("dataPROPHYVAP")

dataPROPHYVAP$VAP_num <- ifelse(dataPROPHYVAP$VAP == "Yes",1,0)
dataPROPHYVAP$GROUP_num <- ifelse(dataPROPHYVAP$GROUP == "Placebo",0,1)


.f <- formula(VAP_num ~ GROUP_num * (AGE + SEX + BMI + DIABETES))

#Note if it takes too long, reduce boot.number
gc1 <- miboot_gc_logistic(formula=.f,m=5, gc.method="ridge", data=dataPROPHYVAP,
                   group="GROUP_num", param.tune=NULL, boot.type="bcv", cv=10,
                   boot.number=500,  effect="ATE", progress=TRUE, boot.tune = TRUE)

print(gc1)
summary(gc1)
plot(gc1) #creates m plots
}
\keyword{Causal inference}
\keyword{G-computation}
\keyword{Multiple imputation}
\keyword{Logistic regression}